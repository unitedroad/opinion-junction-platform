var gulp=require("gulp"),clean=require("gulp-clean"),concat=require("gulp-concat"),rename=require("gulp-rename"),replace=require("gulp-replace"),uglify=require("gulp-uglify"),minifyCss=require("gulp-minify-css"),zip=require("gulp-zip");gulp.task("clean",function(){return gulp.src("dist",{read:false}).pipe(clean())});gulp.task("js",function(){return gulp.src(["js/vendor/**/*","!js/vendor/jquery.js","js/*"]).pipe(concat("main.js")).pipe(uglify({preserveComments:"some"})).pipe(gulp.dest("tmp/js/"))});gulp.task("plugin",function(){return gulp.src("plugin.js").pipe(uglify({preserveComments:"some"})).pipe(rename("plugin.min.js")).pipe(gulp.dest("tmp/"))});gulp.task("css",function(){return gulp.src(["css/bootstrap.min.css","css/bootstrap-theme.min.css","css/youtube.min.css"]).pipe(concat("styles.css")).pipe(minifyCss()).pipe(gulp.dest("tmp/css/"))});gulp.task("html",function(){return gulp.src("youtube.html").pipe(replace(/(\r\n|\n|\r)\s*<link href[^>]*>/ig,function(){return""})).pipe(replace(/<\/title>(\r\n|\n|\r)/i,function(a){return a+'    <link href="./css/styles.css" rel="stylesheet">\r\n'})).pipe(replace(/(\r\n|\n|\r)\s*<script\ssrc="\.(.*)"><\/script>/ig,function(a,b){if(b.match("jquery.min.js")){return a}else{return""}})).pipe(replace("</head>",'  <script src="./js/main.js"><\/script>\r\n</head>')).pipe(gulp.dest("tmp/"))});gulp.task("dist",["clean","html","css","js","plugin"],function(){return gulp.src(["img/**/*","view/**/*","langs/**/*","js/main.js","tmp/**/*","js/vendor/jquery.js","LICENCE","plugin.js","README.md"],{base:"."}).pipe(rename(function(a){a.dirname="youtube/"+a.dirname.replace(/^tmp\/*/,"")})).pipe(zip("youtube.zip")).pipe(gulp.dest("dist/"))});gulp.task("default",["dist"],function(){return gulp.src("tmp",{read:false}).pipe(clean())});
