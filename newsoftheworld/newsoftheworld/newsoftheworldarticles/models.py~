from django.db import models

# Create your models here.
from mongoengine import *

connect('notwcomments')

class Tags(Document):
    tag_name = StringField()

class Categories(Document):
    category_name = StringField()

class SetField(ListField):
    """ Set field.

        Extends ListField, so that's how it's represented in Mongo.
    """
    def __set__(self, instance, value):
        return super().__set__(instance, set(value))

    def to_mongo(self, value):
        return super().to_mongo(list(value))

    def to_python(self, value):
        return set(super().to_python(value))

    def validate(self, value):
        if not isinstance(value, set):
            self.error('Only sets may be used.')

class Author(Document):
    id = StringField(required=True,primary_key=True)
    author_name = StringField()
    first_name = StringField()
    last_name = StringField()
    email_address = StringField()
    user_bio = StringField()
    user_role = StringField()
    user_permissions = ListField(StringField(), required=False)
    user_image = StringField()

class Article(Document):
    author = ReferenceField(Author)
    title = StringField(required=True)
    published_date = DateTimeField()
    status = StringField()
    storytext = StringField()
    storyplaintext = StringField()
    excerpt = StringField()
    slug = StringField()
    tags = ListField(StringField(), required=False)
    categories = ListField(StringField(), required=False)

UPORDOWNVOTECHOICES = (('U', 'Up'),
                       ('D', 'Down'))

class Activity_Record(EmbeddedDocument):
    type = StringField(required=True)
    commentid = StringField()
    userid = StringField()
    upordownvote = StringField(choices = UPORDOWNVOTECHOICES)

class User_Activity(Document):
    id = StringField(required=True,primary_key=True)
    latest_doc = StringField()
    activity_record = EmbeddedDocumentField(Activity_Record)

