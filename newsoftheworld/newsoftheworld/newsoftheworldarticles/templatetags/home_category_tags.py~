from django import template

register = template.Library()

@register.simple_tag(takes_context=True)
def get_category_friendly_name_string(context, article):
    if hasattr(article, "category_friendly_name"):
        return article.category_friendly_names
    
    categories = context['categories']

    if categories is None:
        return article.category

    categoriesMap = None
    if 'categoriesMap' not in context:
        categoriesMap = {}
        for category in categories:
            categoriesMap[category.name] = category
        context['categoriesMap'] = categoriesMap
    else:
        categoriesMap = context['categoriesMap']

    
    

    articleCategories = article.categories
    numArticleCategories = articleCategories.length

    category_friendly_names = ""

    if numArticleCategories > 0:
        category_friendly_names = categoriesMap[articleCategories[0]].friendly_name

    articleCategoriesIndex1 = articleCategories[1:]

    for articleCategory in articleCategoriesIndex1:
        category_friendly_names = category_friendly_names + "," + categoriesMap[articleCategory.friendly_name]

    article.category_friendly_names = category_friendly_names

    return category_friendly_names
        
#
#        if ($scope.categories == null) {
#
#            return;
#        }
#        if (!$scope.categoriesMapCreated) {
#            $scope.categoriesMap = createCategoriesMap($scope.categories);
#            $scope.categoriesMapCreated = true;
#        }
#
#        category_friendly_names = "";
#        if (numArticleCategories > 0) {
#            category_friendly_names = $scope.categoriesMap[articleCategories[0]].friendly_name;
#        }
#
#        for (i = 1; i < numArticleCategories; i++) {
#            category_friendly_names = category_friendly_names + "," + $scope.categoriesMap[articleCategories[i].friendly_name];
#            //if (category.localCompare                                                                                                                                                                                                                                                                                                                                   
#        }
#
#        article.category_friendly_names = category_friendly_names;
#
#        return category_friendly_names;
